<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–ë–∞—Ä–±–µ—Ä—à–æ–ø "–ë—Ä—É—Ç–∞–ª—å–Ω–æ"</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 500px; margin: 0 auto; }
        select, button { width: 100%; padding: 10px; margin: 10px 0; }
        button { background: #0088cc; color: white; border: none; cursor: pointer; }
        .user-data { margin: 20px 0; padding: 10px; background: #f5f5f5; }
    </style>
</head>
<body>
    <h1>–ó–∞–ø–∏—Å—å –≤ –±–∞—Ä–±–µ—Ä—à–æ–ø</h1>
    
    <div id="user-auth" class="user-data">
        –ò–¥—ë—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...
    </div>

    <select id="master">
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞</option>
        <option value="andrey">–ê–Ω–¥—Ä–µ–π</option>
        <option value="evgeny">–ï–≤–≥–µ–Ω–∏–π</option>
    </select>

    <input type="date" id="date" min="">
    
    <select id="time">
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</option>
        <!-- –í—Ä–µ–º—è –¥–æ–±–∞–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
    </select>

    <button onclick="book()">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –∏ –æ–ø–ª–∞—Ç–∏—Ç—å</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞—Å–∫—Ä—ã—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        const user = tg.initDataUnsafe.user;
        if (user) {
            document.getElementById('user-auth').innerHTML = `
                <p>üëã –ü—Ä–∏–≤–µ—Ç, ${user.first_name || '–≥–æ—Å—Ç—å'}!</p>
                <p>–í–∞—à ID: ${user.id}</p>
            `;
        }

        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
        document.getElementById('date').min = new Date().toISOString().split('T')[0];
        
        const timeSelect = document.getElementById('time');
        for (let hour = 9; hour <= 18; hour++) {
            timeSelect.innerHTML += `<option value="${hour}:00">${hour}:00</option>`;
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–ø–ª–∞—Ç–∞
        function book() {
            const master = document.getElementById('master').value;
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;

            if (!master || !date || !time) {
                tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
                return;
            }

            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞—Ç–µ–∂–∞
            const invoice = {
                title: `–°—Ç—Ä–∏–∂–∫–∞ —É ${master === 'andrey' ? '–ê–Ω–¥—Ä–µ—è' : '–ï–≤–≥–µ–Ω–∏—è'}`,
                description: `–î–∞—Ç–∞: ${date}, –í—Ä–µ–º—è: ${time}`,
                payload: `${user.id}_${Date.now()}`, // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–∫–∞–∑–∞
                currency: "RUB",
                prices: [{ label: "–°—Ç—Ä–∏–∂–∫–∞", amount: 150000 }], // 1500 —Ä—É–± (–≤ –∫–æ–ø–µ–π–∫–∞—Ö)
                provider_token: "TEST:1234567890abcdef" // –¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω
            };

            tg.sendInvoice(invoice);
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ Web App –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
        tg.onEvent('invoiceClosed', (event) => {
            if (event.status === 'paid') {
                tg.showAlert("‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞! –ñ–¥—ë–º –≤–∞—Å –≤ –±–∞—Ä–±–µ—Ä—à–æ–ø–µ.");
                tg.close();
            }
        });
    </script>
</body>
</html>
